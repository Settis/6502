address:
  - type: counter
    size: 4
  - type: instruction
    size: 8
  - type: condition
    name: CF
  - type: condition
    name: ZF
  - type: condition
    name: VF
  - type: condition
    name: NF
outBits:
  - name: AddrOut
    offset: 0
  - name: MicRst
    offset: 1
  - name: CntLIn
    offset: 2
  - name: CntHIn
    offset: 3
  - name: CntEn
    offset: 4
  - name: InstIn
    offset: 5
  - name: AluM
    offset: 6
  - name: SecondSelect
    type: enum
    offset: 7
    values:
      - Alu0
      - AluA
      - AluX
      - AluY
      - AluSp
      - AluAddrL
      - AluAddrH
      - AluB
  - name: OpSelect
    type: enum
    offset: 10
    values:
      - Add
      - Sub
      - Or
      - And
      - Xor
      - ASL
      - LSR
      - RTL
      - RTR
      - AddAddrLAndY
  - name: AluOutSelect
    type: enum
    offset: 14
    values:
      - AluToB
      - AluToA
      - AluToX
      - AluToY
      - AluToSP
      - AluToAddrH
      - AluToAddrL
      - AluToF
  - name: DataOutSelect
    type: enum
    offset: 17
    values:
      - DataOutNull
      - DataOutA
      - DataOutB
      - DataOutPcH
      - DataOutPcL
      - DataOutX
      - DataOutY
      - DataOutF
  - name: FlagInst
    type: enum
    offset: 20
    values:
      - FlagNone
      - ClearCarry
      - SetCarry
      - ClearInt
      - SetInt
      - ClearOverfl
      - ClearDec
      - SetDec
  - name: UseCF
    type: enum
    offset: 23
    values:
      - CF0
      - CF1
      - LCF
      - CF
  - name: CFEn
    offset: 25
  - name: ZFEn
    offset: 26
  - name: VFEn
    offset: 27
  - name: NFEn
    offset: 28
defaultStartSteps:
  - InstIn | CntEn
defaultEndSteps:
  - MicRst
prefixSteps:
  - name: ZP
    steps:
      - AluToAddrH
      - AluM | AluToAddrL | CntEn
  - name: ZPX
    steps:
      - AluToAddrH
      - AluM | AluX | Add | AluToAddrL | CntEn
  - name: Abs
    steps:
      - AluM | AluToAddrL | CntEn
      - AluM | AluToAddrH | CntEn
  - name: AbsX
    steps:
      - AluM | AluX | Add | AluToAddrL | CntEn
      - AluM | LCF | Add | AluToAddrH | CntEn
  - name: AbsY
    steps:
      - AluM | AluY | Add | AluToAddrL | CntEn
      - AluM | LCF | Add | AluToAddrH | CntEn
  - name: IndX
    steps:
      - AluToAddrH
      - AluM | AluX | Add | AluToAddrL | CntEn
      - AddrOut | AluM | AluToB
      - AluAddrL | CF1 | Add | AluToAddrL
      - AddrOut | AluM | AluToAddrH
      - AluB | AluToAddrL
  - name: IndY
    steps:
      - AluToAddrH
      - AluM | AluToAddrL | CntEn
      - AddrOut | AluM | AluToB
      - AluAddrL | CF1 | Add | AluToAddrL
      - AddrOut | AluM | AluToAddrH
      - AluB | AluToAddrL
      - AddAddrLAndY | AluToAddrL
      - AluAddrH | LCF | Add | AluToAddrH
commands:
  - name: "BPL+ rewrite"
    value: 0x10
    condition:
      - NF_0
    steps:
      - AluA | AluToX
  - name: "LDA #$44"
    value: 0xA9
    steps:
      - AluM | AluToA | NFEn | ZFEn | CntEn
  - name: "LDA $44"
    value: 0xA5
    prefix: ZP
    steps:
      - AddrOut | AluM | AluToA | NFEn | ZFEn
  - name: "LDA $44,X"
    value: 0xB5
    prefix: ZPX
    steps:
      - AddrOut | AluM | AluToA | NFEn | ZFEn
  - name: "LDA $4400"
    value: 0xAD
    prefix: Abs
    steps:
      - AddrOut | AluM | AluToA | NFEn | ZFEn
  - name: "LDA $4400,X"
    value: 0xBD
    prefix: AbsX
    steps:
      - AddrOut | AluM | AluToA | NFEn | ZFEn
  - name: "LDA $4400,Y"
    value: 0xB9
    prefix: AbsY
    steps:
      - AddrOut | AluM | AluToA | NFEn | ZFEn
  - name: "LDA ($44,X)"
    value: 0xA1
    prefix: IndX
    steps:
      - AddrOut | AluM | AluToA | NFEn | ZFEn
  - name: "LDA ($44),Y"
    value: 0xB1
    prefix: IndY
    steps:
      - AddrOut | AluM | AluToA | NFEn | ZFEn
  - name: "LDX #$44"
    value: 0xA2
    steps:
      - AluM | AluToX | NFEn | ZFEn | CntEn
  - name: "LDY #$44"
    value: 0xA0
    steps:
      - AluM | AluToY | NFEn | ZFEn | CntEn
  - name: "TAX"
    value: 0xAA
    steps:
      - AluA | AluToX
  - name: "STA $44"
    value: 0x85
    prefix: ZP
    steps:
      - AddrOut | DataOutA
  - name: "STA $4400"
    value: 0x8D
    prefix: Abs
    steps:
      - AddrOut | DataOutA
  - name: "Reset"
    value: 0xFF
    type: full
    steps:
      - InstIn
      - CntLIn | CntEn | CntHIn
      - CntLIn | CntEn
      - CntLIn | CntEn
      - CntLIn | CntEn | AluM | AluToAddrH
      - AluM | AluToAddrL
      - CntLIn | CntHIn
